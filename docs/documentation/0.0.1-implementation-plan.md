# Wiki Implementation Plan

**Goal:** Transform the current wiki into a fully functional documentation system that ingests the 137 markdown files from `src/data/documentation/` and displays them with the reference design layout.

**Current Status:**
- ✅ Reference design layout (navbar, 3-column grid, dark theme)
- ✅ Heavy lifter components (DocsArticle, DocsHeader, DocsCodeBlock, DocsPageHeader)
- ✅ Basic routing and navigation structure
- ✅ Markdown files connected to UI (137 files loaded)
- ✅ Navigation tree reflects actual files (auto-generated from M.m.p numbering)
- ✅ Markdown parsing/rendering (using marked + gray-matter)
- ✅ Complete design system applied (Kolkrabbi tokens)
- ✅ WikiComposer with markdown export functionality
- ✅ Block-based editing system integrated

---

## Phase 1: Markdown Integration (Foundation) ✅ COMPLETED

**Goal:** Parse and display the 137 existing markdown files

### Step 1.1: Build Markdown Parser ✅
- ✅ Created utility to parse markdown frontmatter (YAML metadata)
- ✅ Extract: title, version, date, status, category, cross-references
- ✅ Convert markdown body to renderable format
- ✅ Support GFM (GitHub Flavored Markdown) - tables, code blocks, etc.

**Files created:**
- ✅ `src/utils/markdownParser.js` - Parse .md files using marked
- ✅ `src/utils/simpleFrontmatter.js` - Extract YAML metadata (browser-safe)

### Step 1.2: Generate Navigation from Files ✅
- ✅ Scan `src/data/documentation/*.md`
- ✅ Build hierarchical tree based on M.m.p numbering (0.0.0, 1.0.0, etc.)
- ✅ Group by major version (0.x, 1.x, 2.x, etc.)
- ✅ Count items per section (matching reference design)

**Files created:**
- ✅ `src/utils/loadDocs.js` - Build nav tree from files automatically

### Step 1.3: Create Markdown Renderer ✅
- ✅ Component to render parsed markdown
- ✅ Support for:
  - ✅ Headings (H1-H6)
  - ✅ Paragraphs, lists (ordered/unordered)
  - ✅ Code blocks with copy button
  - ✅ Tables
  - ✅ Blockquotes
  - ✅ Links (internal and external)
  - ✅ Images

**Files created:**
- ✅ Heavy lifter components in `src/components/docs/`
- ✅ `WikiArticle.jsx` uses markdown renderer

**Deliverable:** ✅ All 137 files visible in left sidebar nav, clickable, and rendering properly

---

## Phase 1.5: Design System Application ✅ COMPLETED

**Goal:** Apply complete Kolkrabbi design system with strict design rules

### Step 1.5.1: Base Styles & Color System ✅
- ✅ Applied `bg-surface-primary` and `text-auto` to base elements
- ✅ Fixed white-on-white text issue
- ✅ Complete utility classes (`bg-fg-*`, `border-fg-*`, `text-fg-*`)
- ✅ Replaced all hard-coded colors with design tokens

### Step 1.5.2: Border Radius Standardization ✅
- ✅ Standardized ALL border-radius to 4px (ALWAYS, NEVER MORE, NEVER LESS)
- ✅ Configured via @theme in styles.css (Tailwind CSS v4)
- ✅ Deleted tailwind.config.js (not used in v4)

### Step 1.5.3: Typography System ✅
- ✅ Applied `kol-helper-xs` (RightGrotesk Mono 12px) globally
- ✅ Added complete typography classes from index.css
- ✅ Proper font hierarchy and spacing

### Step 1.5.4: WikiComposer Enhancement ✅
- ✅ Block-based editor with live preview
- ✅ Markdown export functionality (download .md files)
- ✅ Version number input (M.m.p format)
- ✅ Copy to clipboard
- ✅ Auto-generated filename from title

**Files modified:**
- ✅ `src/styles.css` - Complete design system
- ✅ `src/main.jsx` - Fixed CSS import structure
- ✅ `src/pages/WikiComposer.jsx` - Export functionality
- ✅ `src/utils/blocksToMarkdown.js` - Block to markdown converter

**Deliverable:** ✅ Complete design system applied, WikiComposer exports markdown

---

## Phase 2: Navigation Enhancement

**Goal:** Make navigation match reference design exactly

### Step 2.1: Tree Navigation Component
- Collapsible/expandable sections
- Item counts per section (e.g., "2.x Design System (8)")
- Active state highlighting
- Nested indentation
- Icons for expand/collapse

**Files to update:**
- `src/components/SidebarNav.jsx` - Rebuild as tree view

### Step 2.2: Breadcrumb Intelligence
- Auto-generate breadcrumbs from file hierarchy
- Make breadcrumbs clickable for parent navigation
- Show full path (e.g., "Wiki / Foundation / Repository Structure")

**Files to update:**
- `src/pages/WikiArticle.jsx` - Smart breadcrumb generation

### Step 2.3: Table of Contents Generator
- Auto-extract H2/H3 from markdown content
- Generate TOC with anchor links
- Scroll spy for active section highlighting
- Smooth scroll to sections

**Files to create:**
- `src/utils/generateToc.js` - Extract headings from markdown
- Update `src/components/docs/DocsToc.jsx` for scroll spy

**Deliverable:** Fully functional tree navigation matching reference design

---

## Phase 3: Content Rendering Polish

**Goal:** Make content look professional and readable

### Step 3.1: Syntax Highlighting
- Add syntax highlighting library (Prism.js or highlight.js)
- Support languages: JavaScript, CSS, JSON, bash, etc.
- Style code blocks to match reference design

**Dependencies to add:**
- `prismjs` or `highlight.js`

### Step 3.2: Typography Refinement
- Heading hierarchy styling (H1 larger, H2-H6 scaled)
- Line height and spacing for readability
- Link styling (underline, hover states)
- List styling (bullets, indentation)

**Files to update:**
- `src/styles.css` - Typography system

### Step 3.3: Content Components
- Callouts/alerts (info, warning, success)
- Image galleries (if used in docs)
- Embedded examples
- Tables with proper styling

**Files to create:**
- `src/components/docs/DocsCallout.jsx`
- `src/components/docs/DocsTable.jsx`

**Deliverable:** Professional looking content rendering matching reference design

---

## Phase 4: Search & Discovery

**Goal:** Make content findable

### Step 4.1: Search Functionality
- Full-text search across all 137 files
- Search by title, content, tags
- Highlight search results
- Keyboard shortcuts (Cmd+K)

**Files to create:**
- `src/utils/searchIndex.js` - Build search index
- `src/components/SearchModal.jsx` - Search UI

### Step 4.2: Cross-Reference System
- Use frontmatter cross-references
- Show related documents
- Parent/child relationships
- "See also" sections

**Files to create:**
- `src/utils/crossReferences.js` - Parse and link references

**Deliverable:** Searchable wiki with discoverability features

---

## Phase 5: Navigation & UX Polish

**Goal:** Make navigation smooth and intuitive

### Step 5.1: Mobile Responsiveness
- Hamburger menu for mobile nav
- Drawer for TOC on mobile
- Touch-friendly interactions
- Responsive typography

**Files to update:**
- `src/components/WikiLayout.jsx` - Mobile drawer
- `src/styles.css` - Mobile breakpoints

### Step 5.2: Keyboard Navigation
- Arrow keys for prev/next article
- Tab navigation
- Escape to close modals
- Focus management

**Files to create:**
- `src/hooks/useKeyboardNav.js`

### Step 5.3: Persistence & State
- Remember last viewed page
- Persist sidebar collapse state
- Remember scroll position
- Dark/light theme toggle (if needed)

**Files to create:**
- `src/hooks/usePersistedState.js`

**Deliverable:** Polished UX with keyboard shortcuts and mobile support

---

## Phase 6: Content Management

**Goal:** Make it easy to add/edit documentation

### Step 6.1: Hot Reload for Markdown
- Watch for markdown file changes
- Auto-reload navigation when files added/removed
- Show file modified dates

**Files to update:**
- Vite config for markdown watching

### Step 6.2: Validation
- Check for broken cross-references
- Validate frontmatter schema
- Warn about missing metadata
- Check for orphaned files (not in nav)

**Files to create:**
- `scripts/validateDocs.js` - CLI validation script

### Step 6.3: Documentation Templates
- Templates for new docs
- Snippets for common patterns
- Style guide enforcement

**Files to create:**
- `docs/templates/` - Doc templates

**Deliverable:** Easy content management workflow

---

## Implementation Order (Recommended)

### Sprint 1 (Core Functionality)
1. Phase 1.1 - Markdown Parser
2. Phase 1.2 - Generate Navigation
3. Phase 1.3 - Markdown Renderer
4. Test: All 137 files visible and rendering

### Sprint 2 (Navigation)
5. Phase 2.1 - Tree Navigation
6. Phase 2.2 - Breadcrumbs
7. Phase 2.3 - TOC Generator
8. Test: Navigation matches reference design

### Sprint 3 (Polish)
9. Phase 3.1 - Syntax Highlighting
10. Phase 3.2 - Typography
11. Phase 3.3 - Content Components
12. Test: Content looks professional

### Sprint 4 (Discovery)
13. Phase 4.1 - Search
14. Phase 4.2 - Cross-References
15. Test: Can find any content quickly

### Sprint 5 (UX)
16. Phase 5.1 - Mobile Responsiveness
17. Phase 5.2 - Keyboard Navigation
18. Phase 5.3 - Persistence
19. Test: Smooth UX across devices

### Sprint 6 (Management)
20. Phase 6.1 - Hot Reload
21. Phase 6.2 - Validation
22. Phase 6.3 - Templates
23. Test: Easy to maintain

---

## Technical Decisions

### Markdown Library
**Option 1:** `marked` + `gray-matter` (lightweight)
**Option 2:** `remark` + `rehype` (powerful, plugin ecosystem)
**Recommendation:** Start with marked (simpler), migrate to remark if needed

### Syntax Highlighting
**Option 1:** `prismjs` (smaller, manual language loading)
**Option 2:** `highlight.js` (auto-detect, larger bundle)
**Recommendation:** Prism.js for control over bundle size

### Search
**Option 1:** Client-side with `fuse.js` (simple, works offline)
**Option 2:** Build-time index (faster, more scalable)
**Recommendation:** fuse.js for simplicity

---

## Success Metrics

- ✅ All 137 markdown files rendered correctly
- ✅ Navigation tree matches file hierarchy
- ✅ TOC auto-generates from headings
- ✅ Search finds content within 500ms
- ✅ Mobile responsive (< 768px)
- ✅ Fast page loads (< 2s)
- ✅ Accessible (keyboard navigation, ARIA)

---

## Next Steps

**Immediate:** Start with Sprint 1, Step 1.1 - Build the markdown parser

**Questions to resolve:**
1. Keep manual wikiPages.js or fully auto-generate from files?
2. Support live editing or read-only for now?
3. Add version history/git integration?
4. Multi-language support needed?

---

*Created: 2025-11-22*
*Status: Planning*
